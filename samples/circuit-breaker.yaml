name: Istio Circuit Breaker
vars:
  for Host: reviews
  maximum TCP Connections: 1
  maximum HTTP requests Per Connection: 1
  outlier Detection For Consecutive 5xx Errors: 1
services:
  istiocircuitbreaker:
    name: istiocircuitbreaker
    type: DestinationRule.Istio
    version: 1.12.9
    namespace: default
    settings:
      host: $(#ref.vars.for Host)
      trafficPolicy:
        connectionPool:
          tcp:
            maxConnections: $(#ref.vars.maximum TCP Connections)
          http:
            http1MaxPendingRequests: 1
            maxRequestsPerConnection: $(#ref.vars.maximum HTTP requests Per Connection)
        outlierDetection:
          consecutive5xxErrors: $(#ref.vars.outlier Detection For Consecutive 5xx Errors)
          interval: 1s
          baseEjectionTime: 3m
          maxEjectionPercent: 100